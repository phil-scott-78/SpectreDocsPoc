@page "/console/{*fileName:nonfile}"
@using MyLittleContentEngine.Services.Content.TableOfContents
@using Spectre.Console
@inject IMarkdownContentService<SpectreConsoleFrontMatter> ConsoleMarkdownContentServices
@inject ContentEngineOptions ContentEngineOptions
@inject ITableOfContentService TableOfContentService

<HeadContent>
    <meta name="description" content="@_description" />
</HeadContent>

<DocumentationPageContent
    PostContent="@_postContent"
    Outline="@_outline"
    NavigationInfo="@_navigationInfo"
    Description="@_description"
    Tags="@_tags"
    SiteTitle="@ContentEngineOptions.SiteTitle"
    Theme="primary" />

@code {
    private string? _postContent;
    private OutlineEntry[]? _outline;
    private NavigationInfo? _navigationInfo;
    private string? _description;
    private IEnumerable<string>? _tags;

    [Parameter] public required string FileName { get; init; } = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        var fileName = FileName;
        if (string.IsNullOrWhiteSpace(fileName))
        {
            fileName = "index";
        }

        var url = $"console/{fileName}";
        var renderedPage = await ConsoleMarkdownContentServices.GetRenderedContentPageByUrlOrDefault(url);

        if (renderedPage != null)
        {
            _postContent = renderedPage.Value.HtmlContent;
            _outline = renderedPage.Value.Page.Outline;
            _description = renderedPage.Value.Page.FrontMatter.Description;
            _tags = renderedPage.Value.Page.FrontMatter.Tags;

            _navigationInfo = await TableOfContentService.GetNavigationInfoAsync($"/{url}");
        }
    }
}
